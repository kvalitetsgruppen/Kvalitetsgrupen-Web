@{
  ViewData["Title"] = "Filhanteraren";

  // Disable layout elements for a clean fullscreen-like view
  ViewData["container"] = "";
  ViewData["isNavbar"] = false;
  ViewData["isMenu"] = false;
  ViewData["isFooter"] = false;
}

@using Syncfusion.EJ2
@using Syncfusion.EJ2.FileManager

@{
  var toolbarItems = new string[]
  {
"NewFolder", "SortBy", "Refresh", "Cut", "Copy", "Paste", "Delete", "Download", "Rename",
"Selection", "View", "Details", "Edit"
  };

  var layoutMenu = new string[] { "SortBy", "View", "Refresh", "|", "Paste", "|", "NewFolder", "|", "Details", "|",
"SelectAll", "Edit" };
  var fileMenu = new string[] { "Cut", "Copy", "|", "Delete", "Download", "Rename", "Edit", "|", "Details" };
}

@section ControlsSection {
  <div class="filemanager-wrapper">
    <ejs-filemanager id="filemanager" view="@ViewType.Details" created="onFileManagerCreated">
      <e-filemanager-ajaxsettings url="/FileExplorer/FileOperations" downloadUrl="/FileExplorer/Download"
        uploadUrl="/FileExplorer/Upload" getImageUrl="/FileExplorer/GetImage">
      </e-filemanager-ajaxsettings>

      <e-filemanager-toolbarsettings items="toolbarItems"></e-filemanager-toolbarsettings>
      <e-filemanager-contextmenusettings layout="layoutMenu" file="fileMenu"></e-filemanager-contextmenusettings>
    </ejs-filemanager>
  </div>
}

@section PageStyles {
  <style>
    html,
    body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #f8f9fa;
    }

    .filemanager-wrapper {
      height: 90vh;
      width: 90vw;
      margin: auto;
      padding: 10px;
      box-sizing: border-box;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    #filemanager,
    .e-filemanager {
      height: 100% !important;
      width: 100% !important;
    }

    /* Custom Edit Icon */
    .e-filemanager .e-toolbar .e-tbar-btn .e-icons.e-edit-icon::before {
      content: '\e7c3';
      font-family: 'e-icons';
    }
  </style>
}

@section Scripts {
  <script>
    function onFileManagerCreated() {
      var fileManager = document.getElementById("filemanager").ej2_instances[0];

      // Expand the tree structure on load
      fileManager.navigationpaneModule.treeObj.expandAll();

      // Optional: assign icon for Edit
      let toolbar = fileManager.toolbarModule.toolbarObj;
      let editBtn = toolbar.items.find(item => item.text === "Edit");
      if (editBtn) {
        editBtn.prefixIcon = "e-icons e-edit-icon";
      }
    }

    document.addEventListener('DOMContentLoaded', function () {
      var fileManager = document.getElementById("filemanager").ej2_instances[0];

      fileManager.toolbarClick = function (args) {
        if (args.item.text === "Edit") {
          var selectedItems = fileManager.getSelectedFiles();
          if (selectedItems.length === 0) {
            alert("Please select a file to edit.");
            return;
          }

          var selectedFile = selectedItems[0];

          if (selectedFile.name.endsWith(".docx") || selectedFile.name.endsWith(".doc")) {
            var publicDocUrl = "https://raw.githubusercontent.com/file-examples/file-examples/main/assets/documents/test.docx";
            var officeViewerUrl = "https://view.officeapps.live.com/op/view.aspx?src=" + encodeURIComponent(publicDocUrl);
            window.open(officeViewerUrl, '_blank');
          } else {
            alert("Only Word (.doc/.docx) files can be edited.");
          }
        }
      };
    });
  </script>
}
